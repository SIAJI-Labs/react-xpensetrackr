import{r as l,j as e,a as E,e as j}from"./app-49e19f09.js";import{u as q,B as v}from"./button-8f2a595a.js";import{v as F}from"./v4-34c6629a.js";import{T}from"./TemplateBackButton-a1494aed.js";import{T as $}from"./TemplateNoData-b0444318.js";import{S as P}from"./SystemLayout-a53fff85.js";import{C as L,b as O,c as k,d as D,a as H}from"./card-2c105230.js";import{U as p}from"./index-84c40666.js";/* empty css            *//* empty css              */import"./index-961138f1.js";import"./index-61f18b0c.js";import"./dialog-dd6b0ada.js";import"./drawer-134f179f.js";import"./theme-toggle-66897dc1.js";import"./ErrorMessage-9da431ff.js";import"./scroll-area-8438057d.js";import"./input-d9c06e18.js";import"./ApplicationLogoMask-c668ea73.js";import"./ApplicationLogo-c5ad270c.js";function se({auth:b,listCategory:C}){q();const[m,_]=l.useState(0),[u,N]=l.useState(0),f=()=>{let r=document.querySelectorAll("li.nst-item > ol.nst-list"),a=document.querySelectorAll("li.nst-item.nst-collapsed > ol.nst-list");_(r.length),N(a.length)},[y,h]=l.useState(""),x=()=>F();let c=!1;const[n,S]=l.useState(),w=()=>{typeof n<"u"&&typeof n=="object"&&n!==null&&n.destroy();let r=new Nestable("#category-list",{maxDepth:1,animation:150});S(r)};let d=null;const A=r=>{d instanceof AbortController&&d.abort();const a=new AbortController;d=a;let t=new FormData;t.append("hierarchy",JSON.stringify(r)),j.post(`${route("api.category.v1.re-order")}`,t,{cancelToken:new j.CancelToken(function(s){a.abort=s})}).then(i=>{p("Action: Success",{description:"Category order successfully updated"})}).catch(i=>{}).finally(()=>{d=null})};return l.useEffect(()=>{n&&(n.on("stop",r=>{if(typeof c<"u"&&c){h(x()),p.error("Action: Failed",{description:"Something went wrong"});return}let a=r.movedNode,t=r.newParentItem;if(a.childNodes.forEach(s=>{s.classList.contains("nst-list")&&r.newParent&&t!==null&&(c=!0)}),typeof c<"u"&&c){h(x()),p.error("Action: Failed",{description:"Parent data cannot be moved inside another parent data!"});return}t==null?r.newParent&&r.originalParent!==r.newParent&&(a.hasAttribute("data-parent_id")&&a.removeAttribute("data-parent_id"),a.querySelector(".item_parent-name")&&a.querySelector(".item_parent-name").remove()):(a.hasAttribute("data-parent_id")||(a.dataset.parent_id=t.dataset.category_id),a.querySelector(".item_parent-name")?a.dataset.parent_id!==t.dataset.category_id&&a.querySelector(".item_parent-name")&&(a.querySelector(".item_parent-name").innerHTML=`${t.querySelector(".item-name").dataset.name} - `):a.querySelector(".item-name").insertAdjacentHTML("afterbegin",`
                            <p class="item_parent-name" data-name="${t.querySelector(".item-name").dataset.name}">${t.querySelector(".item-name").dataset.name} - </p>
                        `));let i=[];r.hierarchy.forEach(s=>{let o=[];s.children!==void 0&&s.children.forEach(g=>{o.push({id:g.node.dataset.category_id})}),o.length>0?i.push({id:s.node.dataset.category_id,child:o}):i.push({id:s.node.dataset.category_id})}),A(i)}),n.on("error.collapsed",()=>{p.error("Action: Failed",{description:"Can't nest in collpased list!"})}),n.on("list.collapse",f),n.on("list.expand",f),f())},[n]),l.useEffect(()=>{h(x())},[]),l.useEffect(()=>{w()},[y]),l.useEffect(()=>{const r=()=>{d instanceof AbortController&&d.abort()};return window.addEventListener("popstate",r),()=>{window.removeEventListener("popstate",r)}}),e.jsxs(P,{user:b.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Category Re-Order"}),fabAction:["category"],children:[e.jsx(E,{title:"Category Re-Order"}),e.jsx(T,{className:"px-0"}),e.jsxs(L,{className:" w-full",children:[e.jsx(O,{children:e.jsxs("div",{className:" flex flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(k,{children:e.jsx("div",{children:"Category: Re-Order"})}),e.jsx(D,{children:"Manage category order"})]}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>m>0?e.jsx(e.Fragment,{children:e.jsxs(v,{variant:"outline",className:" flex flex-row gap-2",onClick:()=>{console.log(n),n&&(m===u?n.expandAll():n.collapseAll())},children:[e.jsx("i",{className:`fa-solid ${m===u?"fa-expand":"fa-compress"}`}),e.jsx("span",{children:m===u?"Expand":"Collapse"})]})}):e.jsx(e.Fragment,{}))()})]})}),e.jsx(H,{children:e.jsx("div",{className:"sa-sortable",children:(()=>{let r=e.jsx($,{}),a=[];return Object.values(C).forEach((t,i)=>{let s=[];t.child&&Object.values(t.child).forEach((o,g)=>{s.push(e.jsxs("li",{"data-category_id":o.uuid,"data-parent_id":t.uuid,children:[e.jsx("div",{className:"nst-handle custom-handle",children:e.jsx("i",{className:"fa-solid fa-grip-vertical"})}),e.jsxs("span",{className:"item-name","data-name":o.name,children:[e.jsxs("p",{className:"item_parent-name","data-name":t.name,children:[t.name," - "]}),o.name]})]},`child_item-${o.uuid}`))}),a.push(e.jsxs("li",{"data-category_id":t.uuid,children:[e.jsx("div",{className:"nst-handle custom-handle",children:e.jsx("i",{className:"fa-solid fa-grip-vertical"})}),e.jsx("span",{className:"item-name","data-name":t.name,children:t.name}),(()=>s.length>0?e.jsx("ol",{"data-category_id":t.uuid,children:s},`parent_category-${t.uuid}`):e.jsx(e.Fragment,{}))()]},`sort_${i}`))}),a.length>0?e.jsx("ol",{id:"category-list",children:a}):r})()})})]})]},y)}export{se as default};
