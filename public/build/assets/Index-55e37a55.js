import{r,j as e,a as $,y as q,d as D,e as p}from"./app-60d7151e.js";import{u as z,B as u}from"./button-2ddd639c.js";import{h as o,f as m,u as B}from"./check-ce530458.js";import{_ as Z,A as H,a as O}from"./react-apexcharts.min-3ce99763.js";import{T as P}from"./TemplateNoData-46e4f46b.js";import{S as U}from"./SystemLayout-add85a2c.js";import{C as W,b as J,c as K,d as Q,a as V}from"./card-46af8ff1.js";import{S as X}from"./separator-d433ee32.js";import{S as n}from"./skeleton-b7939e49.js";/* empty css            */import"./index-099c2811.js";import"./theme-toggle-e974d504.js";import"./ApplicationLogo-f8a0573d.js";/* empty css              */import"./scroll-area-5b96e467.js";import"./input-1ee98765.js";import"./ApplicationLogoMask-d3ce97a9.js";function ge({auth:Y}){const j=z(),[w,g]=r.useState(!0),[v,ee]=r.useState(12);let S=e.jsxs("div",{className:"  border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx(n,{className:" h-4 w-10"}),e.jsxs("div",{className:"  flex flex-row whitespace-nowrap items-center gap-2",children:[e.jsx(n,{className:" h-4 w-24"}),e.jsx(n,{className:" h-4 w-4"})]})]}),e.jsx(n,{className:"h-1 w-full rounded"}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx(n,{className:" h-4 w-10"}),e.jsx(n,{className:" h-4 w-24"})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx(n,{className:" h-4 w-10"}),e.jsx(n,{className:" h-4 w-24"})]})]})]});const[C,se]=r.useState(o().format("Y").toString()),[N,y]=r.useState(null),[i,k]=r.useState(()=>localStorage.getItem("xtrackr-cashflow_index_sort")||"asc"),[c,R]=r.useState([]),[x,b]=r.useState([]),[A,E]=r.useState([]),[I,M]=r.useState([]),[F,_]=r.useState([]),[L,G]=r.useState([]),h=async()=>{g(!0),N instanceof AbortController&&N.abort();const a=new AbortController;y(a);const t=[];try{let d=(await p.get(`${route("api.report.cash-flow.v1.list")}?${t.join("&")}`,{cancelToken:new p.CancelToken(function(T){a.abort=T})})).data.result;d&&"graph"in d&&(g(!1),R(d.graph))}catch(s){p.isCancel(s)?console.log("Request was canceled",s):console.error("Error:",s)}};return r.useEffect(()=>{if(!j){let a=[];if(c&&"data"in c){a=c.data;let t=[],s=[],f=[],d=a.map(l=>l.label);if(E(d),t=a.map(l=>l.income),_(t),s=a.map(l=>l.expense),G(s),f=a.map(l=>l.cash_flow),M([{name:"Income",type:"column",data:t},{name:"Expense",type:"column",data:s},{name:"Cash Flow",type:"line",data:f}]),"data"in c&&c.data.length>0){let l=c.data;i==="desc"&&(l=l.reverse()),b(l)}}}},[c]),r.useEffect(()=>{localStorage.setItem("xtrackr-cashflow_index_sort",i)},[i]),r.useEffect(()=>{j&&h();const a=()=>{setTimeout(()=>{h()},100)};return document.addEventListener("dialog.record.hidden",a),()=>{document.removeEventListener("dialog.record.hidden",a)}}),e.jsx(e.Fragment,{children:e.jsxs(U,{user:Y.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Report: Cash Flow"}),children:[e.jsx($,{title:"Report: Cash Flow"}),e.jsxs(W,{className:" w-full",children:[e.jsx(J,{children:e.jsxs("div",{className:" flex flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(K,{children:e.jsx("div",{children:"Report: Cash Flow"})}),e.jsx(Q,{children:"Cash Flow overview"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{},disabled:!0,children:e.jsx("i",{className:"fa-solid fa-filter"})}),e.jsx(u,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{q.reload(),h()},children:e.jsx("i",{className:`fa-solid fa-rotate-right ${w?"fa-spin":""}`})})]})]})}),e.jsx(V,{children:e.jsxs("div",{className:" flex flex-col gap-6",children:[e.jsx("div",{className:"",children:e.jsx(Z,{options:{chart:{height:100,type:"bar",stacked:!0,toolbar:{show:!1},zoom:{enabled:!1}},colors:["#22c55f","#ef4444","#fbba47"],stroke:{show:!0,width:[0,0,3],curve:"smooth",lineCap:"round"},dataLabels:{enabled:!1},labels:A,yaxis:{labels:{formatter:function(a){return m(a,!0).toString()}},tickAmount:4,forceNiceScale:!0,axisTicks:{show:!0},min:Math.min(...L),max:Math.max(...F)},xaxis:{type:"category",tickPlacement:"between",range:2,tickAmount:5},tooltip:{y:{formatter:function(a){return m(a).toString()}},marker:{show:!0}},plotOptions:{bar:{borderRadius:3,borderRadiusApplication:"end",borderRadiusWhenStacked:"all"}},markers:{size:1}},series:I,type:"line",width:"100%",height:250})}),(()=>{if(w){let a=[];for(let t=0;t<v;t++)a.push(e.jsx("div",{children:S},`skeleton-${t}`));return e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsx("div",{className:" px-4 py-2 rounded border mr-auto",children:e.jsx(n,{className:" h-4 w-10"})}),e.jsx("div",{className:" flex flex-col gap-4",children:a})]})}else{if(x&&x.length>0){let a=[],t=!0;if(x.forEach((s,f)=>{i==="desc"&&o(s.period).format("YYYY")===o().format("YYYY")&&(o(o(s.period).format("YYYY-MM")).isAfter(o().format("YYYY-MM"))?t=!1:t=!0),t&&a.push(e.jsx(D,{href:route("sys.report.cash-flow.show",s.period),children:e.jsxs("div",{className:" border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx("div",{className:"",children:e.jsx("span",{className:" font-semibold",children:s.label})}),e.jsxs("div",{className:" flex flex-row whitespace-nowrap items-center gap-2",children:[e.jsx("span",{className:`${s.cash_flow>0?" text-green-500":s.cash_flow<0?" text-red-500":""} ${s.cash_flow!=0?"font-medium":""}`,children:m(s.cash_flow)}),e.jsx("div",{className:" text-sm",children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})]}),e.jsx(X,{}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx("span",{children:"Income"}),e.jsx("span",{className:" text-green-500",children:m(s.income)})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx("span",{children:"Expense"}),e.jsx("span",{className:" text-red-500",children:m(s.expense*-1)})]})]})]})},`report-${s.label}`)),i==="asc"&&o(s.period).format("YYYY-MM")===o().format("YYYY-MM")&&s.period==o().format("YYYY-MM")&&(t=!1)}),a.length>0)return e.jsx(e.Fragment,{children:e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsxs(u,{variant:"outline",className:" flex flex-row gap-1 mr-auto",onClick:()=>{b(x.reverse()),k(i==="asc"?"desc":"asc")},children:[e.jsx("div",{className:" scale-75",children:(()=>i==="desc"?e.jsx(H,{}):e.jsx(O,{}))()}),e.jsx("span",{className:"",children:B(i)})]}),e.jsx("span",{className:"font-semibold",children:C})]}),e.jsx("div",{className:" flex flex-col gap-4",children:a})]})})}return e.jsx(P,{})}})()]})})]})]})})}export{ge as default};
