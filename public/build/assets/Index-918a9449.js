import{r as c,j as e,a as b,e as y}from"./app-7bc3d3ae.js";import{u as N}from"./button-fcc7bb2d.js";import{v as w}from"./v4-34c6629a.js";import{T as C}from"./TemplateBackButton-8619da25.js";import{T as S}from"./TemplateNoData-4671ee51.js";import{S as E}from"./SystemLayout-48c746f8.js";import{C as A,b as T,c as q,a as v}from"./card-05b7edc2.js";import{u as P}from"./ApplicationLogo-83dbed1f.js";/* empty css            */import"./siaji-fb50d6ec.js";import"./function-47ffd2cb.js";import"./scroll-area-8ede297d.js";import"./x-5654a23d.js";import"./theme-toggle-338a70f6.js";import"./input-5a81755c.js";import"./ApplicationLogoMask-58f1e66b.js";function U({auth:x,listCategory:g}){N();const{toast:m}=P(),[f,u]=c.useState(""),p=()=>w();let l=!1,o=null;const j=()=>{typeof o<"u"&&typeof o=="object"&&o!==null&&o.destroy(),o=new Nestable("#category-list",{maxDepth:1,animation:150}),o.on("stop",r=>{if(typeof l<"u"&&l){u(p()),m({title:"Action: Failed",description:"Something went wrong"});return}let a=r.movedNode,t=r.newParentItem;if(a.childNodes.forEach(i=>{i.classList.contains("nst-list")&&r.newParent&&t!==null&&(l=!0)}),typeof l<"u"&&l){u(p()),m({title:"Action: Failed",description:"Parent data cannot be moved inside another parent data!"});return}t==null?r.newParent&&r.originalParent!==r.newParent&&(a.hasAttribute("data-parent_id")&&a.removeAttribute("data-parent_id"),a.querySelector(".item_parent-name")&&a.querySelector(".item_parent-name").remove()):(a.hasAttribute("data-parent_id")||(a.dataset.parent_id=t.dataset.category_id),a.querySelector(".item_parent-name")?a.dataset.parent_id!==t.dataset.category_id&&a.querySelector(".item_parent-name")&&(a.querySelector(".item_parent-name").innerHTML=`${t.querySelector(".item-name").dataset.name} - `):a.querySelector(".item-name").insertAdjacentHTML("afterbegin",`
                        <p class="item_parent-name" data-name="${t.querySelector(".item-name").dataset.name}">${t.querySelector(".item-name").dataset.name} - </p>
                    `));let n=[];r.hierarchy.forEach(i=>{let s=[];i.children!==void 0&&i.children.forEach(h=>{s.push({id:h.node.dataset.category_id})}),s.length>0?n.push({id:i.node.dataset.category_id,child:s}):n.push({id:i.node.dataset.category_id})}),_(n)})};let d=null;const _=r=>{d instanceof AbortController&&d.abort();const a=new AbortController;d=a;let t=new FormData;t.append("hierarchy",JSON.stringify(r)),y.post(`${route("api.category.v1.re-order")}`,t,{cancelToken:new y.CancelToken(function(i){a.abort=i})}).then(n=>{m({title:"Action: Success",description:"Category order successfully updated"})}).catch(n=>{}).finally(()=>{d=null})};return c.useEffect(()=>{u(p())},[]),c.useEffect(()=>{j()},[f]),c.useEffect(()=>{const r=()=>{d instanceof AbortController&&d.abort()};return window.addEventListener("popstate",r),()=>{window.removeEventListener("popstate",r)}}),e.jsxs(E,{user:x.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Category Re-Order"}),fabAction:["category"],children:[e.jsx(b,{title:"Category Re-Order"}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx(C,{className:"px-0"})}),e.jsxs(A,{className:" w-full",children:[e.jsx(T,{children:e.jsx("div",{className:" flex flex-row justify-between items-start",children:e.jsx("div",{children:e.jsx(q,{children:e.jsx("div",{children:"Category: Re-Order"})})})})}),e.jsx(v,{children:e.jsx("div",{className:"sa-sortable",children:(()=>{let r=e.jsx(S,{}),a=[];return Object.values(g).forEach((t,n)=>{let i=[];t.child&&Object.values(t.child).forEach((s,h)=>{i.push(e.jsxs("li",{"data-category_id":s.uuid,"data-parent_id":t.uuid,children:[e.jsx("div",{className:"nst-handle custom-handle",children:e.jsx("i",{className:"fa-solid fa-grip-vertical"})}),e.jsxs("span",{className:"item-name","data-name":s.name,children:[e.jsxs("p",{className:"item_parent-name","data-name":t.name,children:[t.name," - "]}),s.name]})]},`child_item-${s.uuid}`))}),a.push(e.jsxs("li",{"data-category_id":t.uuid,children:[e.jsx("div",{className:"nst-handle custom-handle",children:e.jsx("i",{className:"fa-solid fa-grip-vertical"})}),e.jsx("span",{className:"item-name","data-name":t.name,children:t.name}),(()=>i.length>0?e.jsx("ol",{"data-category_id":t.uuid,children:i},`parent_category-${t.uuid}`):e.jsx(e.Fragment,{}))()]},`sort_${n}`))}),a.length>0?e.jsx("ol",{id:"category-list",children:a}):r})()})})]})]},f)}export{U as default};
