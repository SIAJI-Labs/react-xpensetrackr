import{r,j as e,a as T,y as $,d as q,e as p}from"./app-dede7cfd.js";import{u as D,B as u}from"./button-fd7c0906.js";import{_ as z,A as B,a as Z}from"./react-apexcharts.min-9b4fb171.js";import{f as m,e as i,u as H}from"./function-8e1ac392.js";import{T as O}from"./TemplateNoData-a84084af.js";import{S as P}from"./SystemLayout-2689f417.js";import{C as U,b as W,c as J,d as K,a as Q}from"./card-e1c4d71b.js";import{S as V}from"./separator-dcd9a55a.js";import{S as o}from"./skeleton-0ede1161.js";/* empty css            */import"./theme-toggle-8f47e51b.js";import"./ApplicationLogo-b7a403a9.js";import"./input-bef20f18.js";import"./ApplicationLogoMask-47c3732b.js";function he({auth:v}){const j=D(),[w,g]=r.useState(!0),[Y,X]=r.useState(5);let S=e.jsxs("div",{className:"  border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsxs("div",{className:"  flex flex-row whitespace-nowrap items-center gap-2",children:[e.jsx(o,{className:" h-4 w-24"}),e.jsx(o,{className:" h-4 w-4"})]})]}),e.jsx(o,{className:"h-1 w-full rounded"}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsx(o,{className:" h-4 w-24"})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsx(o,{className:" h-4 w-24"})]})]})]});const[N,C]=r.useState(null),[n,y]=r.useState(()=>localStorage.getItem("xtrackr-cashflow_index_sort")||"asc"),[c,k]=r.useState([]),[x,b]=r.useState([]),[R,A]=r.useState([]),[E,I]=r.useState([]),[M,_]=r.useState([]),[F,L]=r.useState([]),h=async()=>{g(!0),N instanceof AbortController&&N.abort();const a=new AbortController;C(a);const t=[];try{let d=(await p.get(`${route("api.report.cash-flow.v1.list")}?${t.join("&")}`,{cancelToken:new p.CancelToken(function(G){a.abort=G})})).data.result;d&&"graph"in d&&(g(!1),k(d.graph))}catch(s){p.isCancel(s)?console.log("Request was canceled",s):console.error("Error:",s)}};return r.useEffect(()=>{if(!j){let a=[];if(c&&"data"in c){a=c.data;let t=[],s=[],f=[],d=a.map(l=>l.label);if(A(d),t=a.map(l=>l.income),_(t),s=a.map(l=>l.expense),L(s),f=a.map(l=>l.cash_flow),I([{name:"Income",type:"column",data:t},{name:"Expense",type:"column",data:s},{name:"Cash Flow",type:"line",data:f}]),"data"in c&&c.data.length>0){let l=c.data;n==="desc"&&(l=l.reverse()),b(l)}}}},[c]),r.useEffect(()=>{localStorage.setItem("xtrackr-cashflow_index_sort",n)},[n]),r.useEffect(()=>{j&&h();const a=()=>{setTimeout(()=>{h()},100)};return document.addEventListener("dialog.record.hidden",a),()=>{document.removeEventListener("dialog.record.hidden",a)}}),e.jsx(e.Fragment,{children:e.jsxs(P,{user:v.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Report: Cash Flow"}),children:[e.jsx(T,{title:"Report: Cash Flow"}),e.jsxs(U,{className:" w-full",children:[e.jsx(W,{children:e.jsxs("div",{className:" flex flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(J,{children:e.jsx("div",{children:"Report: Cash Flow"})}),e.jsx(K,{children:"Cash Flow overview"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{},disabled:!0,children:e.jsx("i",{className:"fa-solid fa-filter"})}),e.jsx(u,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{$.reload(),h()},children:e.jsx("i",{className:`fa-solid fa-rotate-right ${w?"fa-spin":""}`})})]})]})}),e.jsx(Q,{children:e.jsxs("div",{className:" flex flex-col gap-6",children:[e.jsx("div",{className:"",children:e.jsx(z,{options:{chart:{height:100,type:"bar",stacked:!0,toolbar:{show:!1},zoom:{enabled:!1}},stroke:{show:!0,width:[0,0,3],curve:"smooth",lineCap:"round"},dataLabels:{enabled:!1},labels:R,yaxis:{labels:{formatter:function(a){return m(a,!0).toString()}},tickAmount:4,forceNiceScale:!0,axisTicks:{show:!0},min:Math.min(...F),max:Math.max(...M)},xaxis:{type:"category",tickPlacement:"between",range:2,tickAmount:5},tooltip:{y:{formatter:function(a){return m(a).toString()}},marker:{show:!0}},plotOptions:{bar:{borderRadius:3,borderRadiusApplication:"end",borderRadiusWhenStacked:"all"}},markers:{size:1}},series:E,type:"line",width:"100%",height:250})}),(()=>{if(w){let a=[];for(let t=0;t<Y;t++)a.push(e.jsx("div",{children:S},`skeleton-${t}`));return e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsx("div",{className:" px-4 py-2 rounded border mr-auto",children:e.jsx(o,{className:" h-4 w-10"})}),e.jsx("div",{className:" flex flex-col gap-4",children:a})]})}else{if(x&&x.length>0){let a=[],t=!0;if(x.forEach((s,f)=>{n==="desc"&&i(s.period).format("YYYY")===i().format("YYYY")&&(i(i(s.period).format("YYYY-MM")).isAfter(i().format("YYYY-MM"))?t=!1:t=!0),t&&a.push(e.jsx(q,{href:route("sys.report.cash-flow.show",s.period),children:e.jsxs("div",{className:" border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx("div",{className:"",children:e.jsx("span",{className:" font-semibold",children:s.label})}),e.jsxs("div",{className:" flex flex-row whitespace-nowrap items-center gap-2",children:[e.jsx("span",{className:`${s.cash_flow>0?" text-green-500":s.cash_flow<0?" text-red-500":""} ${s.cash_flow!=0?"font-medium":""}`,children:m(s.cash_flow)}),e.jsx("div",{className:" text-sm",children:e.jsx("i",{className:"fa-solid fa-chevron-right"})})]})]}),e.jsx(V,{}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx("span",{children:"Income"}),e.jsx("span",{className:" text-green-500",children:m(s.income)})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx("span",{children:"Expense"}),e.jsx("span",{className:" text-red-500",children:m(s.expense*-1)})]})]})]})},`report-${s.label}`)),n==="asc"&&i(s.period).format("YYYY-MM")===i().format("YYYY-MM")&&s.period==i().format("YYYY-MM")&&(t=!1)}),a.length>0)return e.jsx(e.Fragment,{children:e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsxs(u,{variant:"outline",className:" flex flex-row gap-1 mr-auto",onClick:()=>{b(x.reverse()),y(n==="asc"?"desc":"asc")},children:[e.jsx("div",{className:" scale-75",children:(()=>n==="desc"?e.jsx(B,{}):e.jsx(Z,{}))()}),e.jsx("span",{className:"",children:H(n)})]}),e.jsx("div",{className:" flex flex-col gap-4",children:a})]})})}return e.jsx(O,{})}})()]})})]})]})})}export{he as default};
