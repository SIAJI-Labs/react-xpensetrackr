import{r,j as e,e as X,a as ne,y as de}from"./app-49e19f09.js";import{u as oe,B as v}from"./button-8f2a595a.js";import{d as J,c as V,e as ce}from"./index-961138f1.js";import{U as ie}from"./index-84c40666.js";import{u as me,R as pe,D as ue,a as fe,b as xe,c as he,d as je}from"./drawer-134f179f.js";import{E as j}from"./ErrorMessage-9da431ff.js";import{D as ve,a as be,b as we,c as ge,d as Ne}from"./dialog-dd6b0ada.js";import{I as P}from"./input-d9c06e18.js";import{S as Ce,A as Y,a as Z,b as B,c as ee,d as se,e as ae,f as te,g as re,h as le,i as O}from"./SystemLayout-a53fff85.js";import{C as ye,b as Se,c as Ee,a as Pe,e as _e}from"./card-2c105230.js";import{S as Ae}from"./scroll-area-8438057d.js";/* empty css            */import"./index-61f18b0c.js";import"./theme-toggle-66897dc1.js";import"./TemplateNoData-b0444318.js";/* empty css              */import"./ApplicationLogoMask-c668ea73.js";import"./ApplicationLogo-c5ad270c.js";function Te({auth:d,openState:C,setOpenState:y}){const $=oe(),L=me("(min-width: 768px)"),[p,R]=r.useState({current:"password",password:"password",confirmation:"password"}),S=(l,i)=>{R(m=>({...m,[l]:i||(m[l]==="text"?"password":"text")}))},[E,h]=r.useState(""),[_,b]=r.useState(""),[A,T]=r.useState(""),w=()=>{h(""),b(""),T(""),["current","password","confirmation"].map(l=>{S(l,"password")}),g({})},[t,g]=r.useState({}),[u,F]=r.useState(null),U=l=>{u instanceof AbortController&&u.abort(),l.preventDefault();let i=document.getElementById("profilePassword-dialogSubmit");i&&(i.tagName.toLowerCase()==="button"&&i.setAttribute("disabled","disabled"),i.innerHTML='<span class=" flex items-center gap-1"><i class="fa-solid fa-spinner fa-spin-pulse"></i>Loading</span>'),g({});const m=new AbortController;F(m);let a=new FormData;a.append("_method","PUT"),a.append("password",_),a.append("password_confirmation",A),a.append("current_password",E);let D=route("api.profile.v1.update.password",d.user.uuid);X.post(D,a,{signal:m.signal}).then(f=>{if(f.status===200){const N=f.data;(N==null?void 0:N.code)===200&&(y(!1),ie("Action: Success",{description:"Password successfully updated"}))}return!0}).catch(f=>{var I;let H=(I=f.response)==null?void 0:I.data;H.errors&&g(H.errors),setTimeout(()=>{const s=document.querySelectorAll("#profilePassword-dialogForms .form--group.is--invalid");s.length>0&&Array.from(s).reduce((o,n)=>o.offsetTop>n.offsetTop?n:o).scrollIntoView({behavior:"smooth"})},100)}).finally(()=>{F(null);let f=document.getElementById("profilePassword-dialogSubmit");f&&(f.tagName.toLowerCase()==="button"&&f.removeAttribute("disabled"),f.innerHTML="Submit")})};r.useEffect(()=>{$||setTimeout(()=>{u instanceof AbortController&&u.abort(),C?document.dispatchEvent(new CustomEvent("dialog.profile-password.shown",{bubbles:!0})):(w(),document.dispatchEvent(new CustomEvent("dialog.profile-password.hidden",{bubbles:!0})))},100)},[C]),r.useEffect(()=>{const l=i=>{var m;(m=i==null?void 0:i.detail)!=null&&m.uuid?i.detail.uuid:y(!0)};return document.addEventListener("profile-password.edit-action",l),()=>{document.removeEventListener("profile-password.edit-action",l)}},[]);const k=e.jsx(e.Fragment,{children:e.jsx(pe,{className:`overflow-auto border-t border-b ${L?"max-h-screen md:max-h-[50vh]":""}`,children:e.jsxs("form",{onSubmit:U,id:"profilePassword-dialogForms",className:" flex-1 overflow-hidden p-6",children:[e.jsxs("div",{className:`form--group ${t!=null&&t.current_password?" is--invalid":""}`,children:[e.jsx("label",{className:"form--label",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{type:p.current,value:E,id:"form-current_password",onChange:l=>h(l.target.value),placeholder:"Current Password",className:`${t!=null&&t.current_password?" !border-red-500":""}`}),e.jsx("div",{className:" absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("span",{id:"current_password-password_icon",className:` fa-solid ${p.current==="password"?"fa-eye":"fa-eye-slash"} cursor-pointer`,onClick:()=>{S("current")}})})]}),e.jsx(j,{message:t==null?void 0:t.current_password})]}),e.jsxs("div",{className:`form--group ${t!=null&&t.password?" is--invalid":""}`,children:[e.jsx("label",{className:"form--label",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{type:p.password,value:_,id:"form-password",onChange:l=>b(l.target.value),placeholder:"New Password",className:`${t!=null&&t.password?" !border-red-500":""}`}),e.jsx("div",{className:" absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("span",{id:"password-password_icon",className:` fa-solid ${p.password==="password"?"fa-eye":"fa-eye-slash"} cursor-pointer`,onClick:()=>{S("password")}})})]}),e.jsx(j,{message:t==null?void 0:t.password})]}),e.jsxs("div",{className:`form--group !mb-0 ${t!=null&&t.password_confirmation?" is--invalid":""}`,children:[e.jsx("label",{className:"form--label",children:"Password Confirmation"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{type:p.confirmation,value:A,id:"form-password_confirmation",onChange:l=>T(l.target.value),placeholder:"Re-type new Password to Confirm",className:`${t!=null&&t.password_confirmation?" !border-red-500":""}`}),e.jsx("div",{className:" absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("span",{id:"password_confirmation-password_icon",className:` fa-solid ${p.confirmation==="password"?"fa-eye":"fa-eye-slash"} cursor-pointer`,onClick:()=>{S("confirmation")}})})]}),e.jsx(j,{message:t==null?void 0:t.password_confirmation})]})]})})});return L?e.jsx("section",{id:"profilePassword-dialogSection",children:e.jsx(ve,{open:C,onOpenChange:y,children:e.jsxs(be,{className:" flex flex-col h-auto max-lg:bottom-0 max-lg:top-[unset] max-lg:translate-y-0 lg:min-w-[400px] p-0","data-type":"profilePassword-dialog",children:[e.jsx(we,{className:" p-6 pb-2",children:e.jsx(ge,{className:" dark:text-white",children:"Update Password"})}),k,e.jsxs(Ne,{className:" p-6 pt-2",children:[e.jsx(v,{variant:"ghost",onClick:()=>{w()},children:e.jsx("span",{children:"Reset"})}),e.jsx(v,{type:"button",onClick:()=>{document.getElementById("profilePassword-dialogForms")&&document.getElementById("profilePassword-dialogForms").dispatchEvent(new Event("submit",{bubbles:!0}))},id:"profilePassword-dialogSubmit",children:"Submit"})]})]})})}):e.jsx("section",{id:"profilePassword-dialogSection",children:e.jsx(ue,{open:C,onOpenChange:y,children:e.jsxs(fe,{className:" max-h-dvh",children:[e.jsx(xe,{className:"text-left",children:e.jsx(he,{className:" text-center",children:"Update Password"})}),k,e.jsxs(je,{className:"pt-2",children:[e.jsx(v,{type:"button",onClick:()=>{document.getElementById("profilePassword-dialogForms")&&document.getElementById("profilePassword-dialogForms").dispatchEvent(new Event("submit",{bubbles:!0}))},id:"profilePassword-dialogSubmit",children:"Submit"}),e.jsx(v,{variant:"ghost",onClick:()=>{w()},children:e.jsx("span",{children:"Reset"})})]})]})})})}function We({auth:d}){var I;const C=oe(),[y,$]=r.useState(!1),L=s=>{$(s)};let p="template",R="initials";d.user.avatar&&d.user.avatar in J?(p="template",R=d.user.avatar):p="custom";const[S,E]=r.useState(),[h,_]=r.useState(p),[b,A]=r.useState(R),[T,w]=r.useState([]),[t,g]=r.useState(""),[u,F]=r.useState(d.user.name),[U,k]=r.useState(d.user.email),[l,i]=r.useState("username"in d.user?(I=d.user)==null?void 0:I.username:""),m=(s=d.user)=>{F(s.name),k(s.email),i("username"in s?s==null?void 0:s.username:""),w([]),g("");let c="custom",o="initials";s.avatar&&s.avatar in J&&(c="template",o=s.avatar),_(c),c==="template"&&A(o);let n=V(s);E(n)},[a,D]=r.useState({}),[f,N]=r.useState(null),H=s=>{s.preventDefault();let c=document.getElementById("profile-submit");c&&(c.tagName.toLowerCase()==="button"&&c.setAttribute("disabled","disabled"),c.innerHTML='<span class=" flex items-center gap-1"><i class="fa-solid fa-spinner fa-spin-pulse"></i>Loading</span>'),D({});const o=new AbortController;N(o);let n=new FormData;n.append("_method","PUT"),n.append("name",u),n.append("email",U),l&&n.append("username",l),n.append("avatar_type",h),h==="custom"&&T?n.append("avatar_file",T):n.append("avatar_template",b);let G=route("api.profile.v1.update",d.user.uuid);X.post(G,n,{headers:{"Content-Type":"multipart/form-data"},cancelToken:new X.CancelToken(function(q){o.abort=q})}).then(x=>{if(x.status===200){de.reload();let M=x.data.result.data;m(M),ie("Action: Success",{description:"Profile successfully updated"})}}).catch(x=>{var z;let M=(z=x.response)==null?void 0:z.data;M.errors&&D(M.errors),setTimeout(()=>{const Q=document.querySelectorAll("#profile-forms .form--group.is--invalid");Q.length>0&&Array.from(Q).reduce((K,W)=>K.offsetTop>W.offsetTop?W:K).scrollIntoView({behavior:"smooth"})},100)}).finally(()=>{N(null);let x=document.getElementById("profile-submit");x&&(x.tagName.toLowerCase()==="button"&&x.removeAttribute("disabled"),x.innerHTML="Submit")})};return r.useEffect(()=>{if(!C){let s=V(void 0,b,u);E(s)}},[b,u]),r.useEffect(()=>{let s=V(d.user);E(s)},[]),e.jsxs(Ce,{user:d.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Profile"}),children:[e.jsx(ne,{title:"Profile"}),e.jsx(Te,{auth:d,openState:y,setOpenState:L}),e.jsx("form",{onSubmit:H,id:"profile-forms",children:e.jsxs(ye,{className:" w-full",children:[e.jsx(Se,{children:e.jsx("div",{children:e.jsx(Ee,{children:e.jsx("div",{children:"Profile"})})})}),e.jsxs(Pe,{children:[e.jsxs("div",{className:"flex flex-row gap-6 mb-4",children:[e.jsx("div",{className:" w-1/4",children:e.jsx("div",{className:"border rounded-md p-4 w-full aspect-square flex items-center justify-center",children:e.jsxs(Y,{className:" cursor-pointer rounded-lg",children:[e.jsx(Z,{src:S,alt:"Avatar Preview"}),e.jsx(B,{className:" cursor-pointer rounded-lg",children:"EX"})]})})}),e.jsx("div",{className:" w-3/4",children:e.jsxs("div",{className:"form--group",children:[e.jsx("label",{className:"form--label",children:"Type"}),e.jsxs(ee,{onValueChange:s=>{_(s)},value:h,children:[e.jsx(se,{className:`dark:text-white ${a!=null&&a.avatar_type?" !border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select an option",className:"dark:text-white"})}),e.jsx(te,{children:e.jsxs(re,{children:[e.jsx(le,{children:"Select avatar style"}),e.jsx(O,{value:"template",children:"Template"}),e.jsx(O,{value:"custom",children:"Custom"})]})})]}),e.jsx(j,{message:a==null?void 0:a.avatar_type})]})})]}),(()=>h==="template"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form--group",children:[e.jsx("label",{className:"form--label",children:"Avatar"}),e.jsxs(ee,{onValueChange:s=>{A(s)},value:b,children:[e.jsx(se,{className:`dark:text-white ${a!=null&&a.avatar_template?" !border-red-500":""}`,children:e.jsx(ae,{placeholder:"Select an option",className:"dark:text-white"})}),e.jsx(te,{children:e.jsx(re,{children:e.jsx(Ae,{className:"p-0",children:e.jsxs("div",{className:"max-h-[10rem]",children:[e.jsx(le,{children:"Select avatar"}),(()=>{let s=[];return Object.keys(J).map((o,n)=>o).forEach((o,n)=>{let G=V(void 0,o,u);s.push(e.jsx(O,{value:o,className:"flex w-full",children:e.jsxs("div",{className:"flex gap-4 flex-row items-center justify-between w-full",children:[e.jsx("span",{children:e.jsxs(Y,{className:" cursor-pointer h-6 aspect-square rounded-md",children:[e.jsx(Z,{src:G,alt:"@shadcn"}),e.jsx(B,{className:" cursor-pointer rounded-lg",children:"EX"})]})}),e.jsx("span",{children:ce(o)})]})},o))}),s})()]})})})})]}),e.jsx(j,{message:a==null?void 0:a.avatar_template})]})}):h==="custom"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form--group",children:[e.jsx("label",{className:"form--label",children:"Upload an Avatar"}),e.jsxs("div",{className:"!tw__border-inherit",children:[e.jsxs("label",{htmlFor:"input_profile-avatar_file",className:" p-4 rounded-md border-2 border-dashed flex items-center gap-4 cursor-pointer",children:[e.jsx("i",{className:"fa-solid fa-paperclip text-2xl -rotate-45"}),e.jsxs("div",{className:"",children:[e.jsx("input",{type:"file",id:"input_profile-avatar_file",onChange:s=>{var c,o;(c=s.target)!=null&&c.files&&w((o=s.target)==null?void 0:o.files[0]),g(s.target.value)},className:"hidden",accept:"image/jpeg,image/jpg,image/png,image/svg"}),e.jsx("div",{className:`tw__font-bold mb-1 ${t?" underline":""}`,id:"input_profile-avatar_label_helper",children:t?t.split(/(\\|\/)/g).pop():"Choose Image"}),e.jsx("div",{className:"tw__font-light text-xs",children:"JPG/JPEG, PNG or SVG. Max size of 512kb"})]})]}),(()=>t?e.jsx(e.Fragment,{children:e.jsx(v,{variant:"link",className:"px-0 text-red-500 py-1 !h-auto leading-none",onClick:()=>{let s=document.getElementById("input_profile-avatar_file");s&&(console.log(s),s.value="",w([]),g(""))},children:"Remove"})}):e.jsx(e.Fragment,{}))()]})]})}):e.jsx(e.Fragment,{}))(),e.jsxs("div",{className:"form--group",children:[e.jsx("label",{className:"form--label",children:"Name"}),e.jsx(P,{value:u,onChange:s=>F(s.target.value),placeholder:"Name",className:`${a!=null&&a.name?" !border-red-500":""}`}),e.jsx(j,{message:a==null?void 0:a.name})]}),e.jsxs("div",{className:"form--group",children:[e.jsx("label",{className:"form--label",children:"Email"}),e.jsx(P,{form:U,onChange:s=>k(s.target.value),placeholder:"Email",className:`${a!=null&&a.email?" !border-red-500":""}`}),e.jsx(j,{message:a==null?void 0:a.email})]}),e.jsxs("div",{className:"form--group !mb-0",children:[e.jsx("label",{className:"form--label",children:"Username"}),e.jsx(P,{value:l,onChange:s=>i(s.target.value),placeholder:"Username",className:`${a!=null&&a.username?" !border-red-500":""}`}),e.jsx(j,{message:a==null?void 0:a.username})]})]}),e.jsxs(_e,{className:" flex flex-row justify-between gap-4",children:[e.jsx(v,{type:"button",variant:"link",className:" px-0 text-red-500",onClick:()=>{$(!0)},children:"Change Password"}),e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsx(v,{type:"button",variant:"ghost",onClick:()=>{m()},children:"Reset"}),e.jsx(v,{id:"profile-submit",children:"Submit"})]})]})]})})]})}export{We as default};
