import{r as a,e as h,j as e,a as F,y as q}from"./app-6ad0fa3b.js";import{m as t,f as j}from"./Combination-3409af4d.js";import{L as z}from"./ListTemplate-2077b631.js";import{S as P,L as U}from"./separator-7b94592a.js";import{B as H}from"./BackButtonTemplate-9f01ecc3.js";import{N as G}from"./skeleton-cfbb3530.js";import{S as J}from"./SystemLayout-9dd83e4c.js";import{C as K,b as O,c as Q,d as V,a as W,e as X}from"./card-1c98e8a1.js";import{u as Z,B as m}from"./button-aef6a608.js";import"./dropdown-menu-67aeed53.js";import"./ApplicationLogo-afb7e8a5.js";import"./ApplicationLogoMask-473138df.js";import"./textarea-18e017d1.js";import"./input-0a02cd69.js";function ue({auth:k,wallet:s,period:g,estimate_income:$=0,estimate_expense:E=0}){const M=Z();a.useEffect(()=>{console.log(s),S()},[]);const[v,b]=a.useState(null),[D,y]=a.useState(!0),[i,R]=a.useState();let f=5;const[u,C]=a.useState(f),[I,N]=a.useState(!1),S=async()=>{y(!0),v instanceof AbortController&&v.abort();const n=new AbortController;b(n);const r=[],d={filter_period:t(c).format("YYYY-MM-DD"),filter_period_timezone:t.tz.guess(),limit:u};for(const o in d)r.push(encodeURIComponent(o)+"="+encodeURIComponent(d[o]));try{let l=(await h.get(`${route("api.planned-payment.summary.v1.show",s==null?void 0:s.uuid)}?${r.join("&")}`,{cancelToken:new h.CancelToken(function(A){n.abort=A})})).data;R(l.result.data),N(l.result.has_more),y(!1),b(null)}catch(o){h.isCancel(o)?console.log("Request was canceled",o):console.error("Error:",o)}};let L=n=>e.jsx(z,{plannedPayment:n==null?void 0:n.planned});const[_,B]=a.useState(5);let T=()=>e.jsx(U,{});a.useEffect(()=>{i&&B(i.length>0?i.length:3)},[i]);const[c,Y]=a.useState();if(c===void 0){let n=t();g!==null&&(n=t(g)),Y(t(n).toDate())}const x=(n="prev")=>{let r=t(c);n==="prev"?r=t(r).subtract(1,"months"):n==="next"?r=t(r).add(1,"months"):n==="current"&&(r=t()),Y(t(r).toDate())};return a.useEffect(()=>{C(f)},[c]),a.useEffect(()=>{M||S()},[u,c]),a.useEffect(()=>{const n=r=>{q.reload()};return document.addEventListener("dialogRecord",n),()=>{document.removeEventListener("dialogRecord",n)}}),e.jsx(e.Fragment,{children:e.jsxs(J,{user:k.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Planned Summary: ",`${s!=null&&s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`]}),children:[e.jsx(F,{title:`Planned Summary: ${s!=null&&s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx(H,{className:"px-0"})}),e.jsxs(K,{className:" w-full",children:[e.jsx(O,{children:e.jsxs("div",{className:" relative flex flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(Q,{children:e.jsxs("div",{children:["Planned Summary: ",`${s!=null&&s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`]})}),e.jsxs(V,{children:["See summary of ",e.jsx("u",{children:`${s!=null&&s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`})," wallet"]})]}),(()=>e.jsx(m,{variant:"outline",onClick:()=>{},children:e.jsx("i",{className:"fa-solid fa-rotate-right"})}))()]})}),e.jsx(W,{children:e.jsxs("div",{className:" flex flex-col gap-6",children:[e.jsxs("div",{className:" border p-4 rounded-lg flex flex-col gap-3 mb-2",children:[e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:"Current Balance"}),e.jsx("span",{children:j(s==null?void 0:s.current_balance)})]}),e.jsx(P,{}),e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:"Estimate Income"}),e.jsx("span",{className:" text-green-500",children:j($)})]}),e.jsx(P,{}),e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:"Estimate Expense"}),e.jsx("span",{className:" text-red-500",children:j(E)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsx(m,{variant:"ghost",onClick:()=>{x("prev")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-left"})})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(m,{variant:"outline",className:"px-6",children:t(c).format("MMMM, YYYY")})}),e.jsx(m,{variant:"ghost",onClick:()=>{x("next")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-right"})})})]}),(()=>t().format("YYYY-MM-DD")!=t(c).format("YYYY-MM-DD")?e.jsxs(m,{variant:"link",className:"py-0",onClick:()=>{x("current")},children:["Back to current period (",t().format("MMM, YYYY"),")"]}):e.jsx(e.Fragment,{}))()]}),(()=>{if(D){let n=[];for(let r=0;r<_;r++)n.push(e.jsx("div",{children:T()},`skeleton-${r}`));return n}else{let n=[],r=e.jsx(G,{}),d=null;return i&&i.length>0&&i.map((o,l)=>{let p=!1;(d===null||d!==o.period)&&(p=!0,d=o.period),l>0&&p&&n.push(e.jsx("div",{children:e.jsx("div",{className:" flex justify-center relative before:absolute before:border-t before:w-[calc(50%-1.25rem)] before:left-0 before:top-1/2 before:-translate-y-1/2 before:h-1 after:absolute after:border-t after:w-[calc(50%-1.25rem)] after:right-0 after:top-1/2 after:-translate-y-1/2 after:h-1",children:e.jsx("span",{children:e.jsx("i",{className:"fa-regular fa-clock"})})})},`period_separator-${l}`)),n.push(e.jsx("div",{children:L(o)},`planned_item-${l}`))}),n.length>0?n:r}})()]})}),e.jsx(X,{children:e.jsx("div",{children:e.jsx(m,{variant:"outline",className:"dark:border-white",disabled:!I,onClick:()=>{N(!1),C(u+f)},children:"Load more"})})})]})]})})}export{ue as default};
