import{r as l,j as e,a as $,y as D,e as p}from"./app-62588a58.js";import{T as E}from"./TemplateBackButton-50add7d6.js";import{T}from"./TemplateNoData-b507a7ee.js";import{u as _,B as j}from"./button-0e6b1241.js";import{C as F,b as L,c as A,d as q,a as B}from"./card-e22fc76b.js";import{S as G,a as U}from"./SystemLayout-91fa1210.js";import{S as o}from"./skeleton-079cf0e2.js";import{e as t,f as u,u as H}from"./function-52aba9f1.js";/* empty css            */import"./ApplicationLogo-8c57e70d.js";import"./textarea-4f970963.js";import"./ApplicationLogoMask-179929d9.js";import"./input-434a36f9.js";function le({auth:v,period:x}){const C=_();let c=t(`${x}-01`).format("MMM, YYYY");const[w,g]=l.useState(!0),[M,z]=l.useState(5);let y=e.jsxs("div",{className:"  border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsxs("div",{className:"  flex flex-row whitespace-nowrap items-center gap-2",children:[e.jsx(o,{className:" h-4 w-24"}),e.jsx(o,{className:" h-4 w-4"})]})]}),e.jsx(o,{className:"h-1 w-full rounded"}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsx(o,{className:" h-4 w-24"})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx(o,{className:" h-4 w-10"}),e.jsx(o,{className:" h-4 w-24"})]})]})]});const[N,S]=l.useState(null),[d,k]=l.useState([]),[f,Y]=l.useState([]),[n,R]=l.useState(()=>localStorage.getItem("xtrackr-cashflow_show_sort")||"asc"),m=async()=>{g(!0),N instanceof AbortController&&N.abort();const s=new AbortController;S(s);const r=[],a={year:t(`${x}-01`).format("YYYY"),month:t(`${x}-01`).format("MM")};for(const i in a)r.push(encodeURIComponent(i)+"="+encodeURIComponent(a[i]));try{let b=(await p.get(`${route("api.report.cash-flow.v1.list")}?${r.join("&")}`,{cancelToken:new p.CancelToken(function(I){s.abort=I})})).data,h=b.result;h&&"graph"in h&&(g(!1),k(h.graph)),console.log(b)}catch(i){p.isCancel(i)?console.log("Request was canceled",i):console.error("Error:",i)}};return l.useEffect(()=>{if("data"in d&&d.data.length>0){let s=d.data;n==="desc"&&(s=s.reverse()),Y(s)}},[d]),l.useEffect(()=>{localStorage.setItem("xtrackr-cashflow_show_sort",n)},[n]),l.useEffect(()=>{C&&m();const s=()=>{setTimeout(()=>{m()},100)};return document.addEventListener("dialog.record.hidden",s),()=>{document.removeEventListener("dialog.record.hidden",s)}}),e.jsxs(G,{user:v.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Report: Cash Flow (",c,")"]}),children:[e.jsx($,{title:`Report: Cash Flow (${c})`}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx(E,{className:"px-0"})}),e.jsxs(F,{className:" w-full",children:[e.jsx(L,{children:e.jsxs("div",{className:" flex flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(A,{children:e.jsxs("div",{children:["Report: ",c]})}),e.jsxs(q,{children:["Cash Flow overview for ",e.jsx("u",{children:c})," period"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{},disabled:!0,children:e.jsx("i",{className:"fa-solid fa-filter"})}),e.jsx(j,{variant:"outline",className:" w-10 aspect-square",onClick:()=>{m(),D.reload()},children:e.jsx("i",{className:`fa-solid fa-rotate-right ${w?"fa-spin":""}`})})]})]})}),e.jsx(B,{children:(()=>{if(w){let s=[];for(let r=0;r<M;r++)s.push(e.jsx("div",{children:y},`skeleton-${r}`));return e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsx("div",{className:" px-4 py-2 rounded border mr-auto",children:e.jsx(o,{className:" h-4 w-10"})}),e.jsx("div",{className:" flex flex-col gap-4",children:s})]})}else{if(f&&f.length>0){let s=[],r=!0;if(f.forEach((a,i)=>{n==="desc"&&t(a.label).format("YYYY-MM")===t().format("YYYY-MM")&&(t(t(a.label).format("YYYY-MM-DD")).isAfter(t().format("YYYY-MM-DD"))?r=!1:r=!0),r&&s.push(e.jsxs("div",{className:" border rounded p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsx("div",{className:"",children:e.jsx("span",{className:"font-semibold",children:t(a.label).format("MMM Do, YYYY")})}),e.jsx("div",{className:" flex flex-row whitespace-nowrap items-center gap-2",children:e.jsx("span",{className:`${a.cash_flow>0?" text-green-500":a.cash_flow<0?" text-red-500":""} ${a.cash_flow!=0?"font-medium":""}`,children:u(a.cash_flow)})})]}),e.jsx(U,{}),e.jsxs("div",{className:" flex flex-row justify-between items-center",children:[e.jsxs("div",{className:" flex flex-col gap-1 leading-none",children:[e.jsx("span",{children:"Income"}),e.jsx("span",{className:" text-green-500",children:u(a.income)})]}),e.jsxs("div",{className:" flex flex-col gap-1 leading-none items-end",children:[e.jsx("span",{children:"Expense"}),e.jsx("span",{className:" text-red-500",children:u(a.expense*-1)})]})]})]},`report-${a.label}`)),n==="asc"&&t(a.label).format("YYYY-MM")===t().format("YYYY-MM")&&a.label==t().format("YYYY-MM-DD")&&(r=!1)}),s.length>0)return e.jsx(e.Fragment,{children:e.jsxs("div",{className:" flex flex-col gap-2",children:[e.jsxs(j,{variant:"outline",className:" flex flex-row gap-1 mr-auto",onClick:()=>{Y(f.reverse()),R(n==="asc"?"desc":"asc")},children:[e.jsx("div",{className:" w-4",children:e.jsx("i",{className:`fa-solid ${n==="asc"?"fa-sort-up":"fa-sort-down"}`})}),e.jsx("span",{className:"",children:H(n)})]}),e.jsx("div",{className:" flex flex-col gap-4",children:s})]})})}return e.jsx(T,{})}})()})]})]})}export{le as default};
