import{r as i,j as e,d as R,e as b}from"./app-49e19f09.js";import{B as m,u as T}from"./button-8f2a595a.js";import{a as t,f as g}from"./index-961138f1.js";import{D as F,a as A,b as L,c as O,T as q}from"./TemplateNoData-b0444318.js";import{S as d}from"./skeleton-3b1a4842.js";/* empty css            */import"./index-61f18b0c.js";/* empty css              */function z({plannedPayment:s,period:a}){let u=(Math.random()+1).toString(36).substring(7);const[p,h]=i.useState(!1);return e.jsx("section",{onClick:o=>{h(!0)},children:e.jsxs("div",{className:" flex flex-col gap-2 border rounded p-4 cursor-pointer",children:[e.jsxs("div",{className:" flex flex-col gap-1",children:[e.jsxs("div",{className:" flex flex-row gap-6 justify-between",children:[e.jsx("span",{className:" whitespace-nowrap overflow-hidden overflow-ellipsis font-semibold",children:s&&s?`${s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`:"Wallet Name"}),e.jsx("div",{children:e.jsxs(F,{open:p,onOpenChange:h,children:[e.jsx(A,{asChild:!0,children:e.jsx(m,{variant:"link",className:" p-0 h-auto leading-none dark:!text-white !text-black","data-type":"dropdown-trigger",children:e.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})})}),e.jsx(L,{sideOffset:5,alignOffset:0,side:"left",align:"start",children:e.jsx(R,{href:s?route("sys.planned-payment.summary.show",{wallet:s.uuid,period:a!==void 0?t(a).format("YYYY-MM"):null}):"#",children:e.jsx(O,{className:" cursor-pointer",children:e.jsx("span",{className:" text-blue-500",children:"Detail"})})})})]})})]}),(()=>{if(t(a).format("YYYY-MM")===t().format("YYYY-MM")&&s&&"balance"in s){let o=0,l=0;s&&"expected_income"in s&&(o=s.expected_income),s&&"expected_expense"in s&&(l=s.expected_expense);let c=s.balance+(o-l);return e.jsxs("div",{className:" flex flex-row flex-wrap leading-tight gap-1",children:[e.jsxs("small",{children:["Current balance: ",g(s.balance)]}),e.jsx("small",{children:"/"}),e.jsxs("small",{children:["Expected final balance: ",g(c)]})]})}return e.jsx(e.Fragment,{})})()]}),e.jsx("hr",{}),e.jsxs("div",{className:" flex flex-col gap-1",children:[e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:(()=>{if(s&&"expected_planned_income"in s){let l=0,c="expected";typeof s.expected_planned_income=="object"?l=s.expected_planned_income.length:typeof s.expected_planned_income=="number"&&(l=s.expected_planned_income);var o=t(a).isBefore(t(),"month")||t(a).isSame(t(),"month")&&t(a).isBefore(t(),"year");return o&&(c="recorded"),`${l} ${c} Income`}return e.jsx(e.Fragment,{})})()}),e.jsx("span",{className:"text-green-500",children:g(s&&s.expected_income?s.expected_income:0)})]}),e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:(()=>{if(s&&"expected_planned_expense"in s){let l=0,c="expected";typeof s.expected_planned_expense=="object"?l=s.expected_planned_expense.length:typeof s.expected_planned_expense=="number"&&(l=s.expected_planned_expense);var o=t(a).isBefore(t(),"month")||t(a).isSame(t(),"month")&&t(a).isBefore(t(),"year");return o&&(c="recorded"),`${l} ${c} Income`}return e.jsx(e.Fragment,{})})()}),e.jsx("span",{className:"text-red-500",children:g(s&&s.expected_expense?s.expected_expense:0)})]})]})]})},u)}function U(){let s=(Math.random()+1).toString(36).substring(7);return e.jsx("section",{children:e.jsxs("div",{className:" flex flex-col gap-2 border rounded p-4 cursor-pointer",children:[e.jsxs("div",{className:" flex flex-row gap-6 justify-between",children:[e.jsx(d,{className:"h-4 w-40"}),e.jsx(d,{className:"h-4 w-2"})]}),e.jsxs("div",{className:" mt-2 flex flex-col gap-2",children:[e.jsx(d,{className:"h-1 w-full"}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:" flex flex-row gap-2",children:[e.jsx(d,{className:" h-4 w-4"}),e.jsx(d,{className:" h-4 w-20"})]}),e.jsx(d,{className:" h-4 w-6"})]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:" flex flex-row gap-2",children:[e.jsx(d,{className:" h-4 w-4"}),e.jsx(d,{className:" h-4 w-20"})]}),e.jsx(d,{className:" h-4 w-6"})]})]})]})},s)}function y({auth:s}){const a=T();i.useEffect(()=>{w()},[]);const[u,p]=i.useState(null),[h,o]=i.useState(!0),[l,c]=i.useState();let _=5;const[v,C]=i.useState(_),[k,Y]=i.useState(!1),w=async()=>{o(!0),u instanceof AbortController&&u.abort();const r=new AbortController;p(r);const n=[],j={filter_period:t(f).format("YYYY-MM-DD"),filter_period_timezone:t.tz.guess(),limit:v};for(const x in j)n.push(encodeURIComponent(x)+"="+encodeURIComponent(j[x]));try{let S=(await b.get(`${route("api.planned-payment.summary.v1.list")}?${n.join("&")}`,{cancelToken:new b.CancelToken(function(B){r.abort=B})})).data;c(S.result.data),Y(S.result.has_more),o(!1),p(null)}catch(x){b.isCancel(x)?console.log("Request was canceled",x):console.error("Error:",x)}};let D=r=>e.jsx(z,{plannedPayment:r,period:t(f).toDate()});const[I,$]=i.useState(5);let E=()=>e.jsx(U,{});i.useEffect(()=>{l&&$(l.length>0?l.length:3)},[l]);const[f,M]=i.useState();if(f===void 0){let r=t();M(t(r).toDate())}const N=(r="prev")=>{let n=t(f);r==="prev"?n=t(n).subtract(1,"months"):r==="next"?n=t(n).add(1,"months"):r==="current"&&(n=t()),M(t(n).toDate())};return i.useEffect(()=>{a||w()},[v,f]),i.useEffect(()=>{if(!a){const r=()=>{console.log("ABC"),setTimeout(()=>{w()},100)};return document.addEventListener("planned-payment.refresh",r),()=>{document.removeEventListener("planned-payment.refresh",r)}}}),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsx(m,{variant:"ghost",onClick:()=>{N("prev")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-left"})})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(m,{variant:"outline",className:"px-6",children:t(f).format("MMMM, YYYY")})}),e.jsx(m,{variant:"ghost",onClick:()=>{N("next")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-right"})})})]}),(()=>t().format("YYYY-MM-DD")!=t(f).format("YYYY-MM-DD")?e.jsxs(m,{variant:"link",className:"py-0",onClick:()=>{N("current")},children:["Back to current period (",t().format("MMM, YYYY"),")"]}):e.jsx(e.Fragment,{}))()]}),e.jsx("div",{className:" flex flex-col gap-4",children:(()=>{if(h){let r=[];for(let n=0;n<I;n++)r.push(e.jsx("div",{children:E()},`skeleton-${n}`));return r}else{let r=[],n=e.jsx(q,{});return l&&l.length>0&&l.map((j,x)=>{r.push(e.jsx("div",{children:D(j)},`planned_item-${x}`))}),r.length>0?r:n}})()}),e.jsx("div",{children:e.jsx(m,{variant:"outline",className:"dark:border-white",disabled:!k,onClick:()=>{Y(!1),C(v+_)},children:"Load more"})})]})})}export{y as default};
