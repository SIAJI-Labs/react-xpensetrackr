import{r as a,j as e,d as R,e as N}from"./app-f9c29e53.js";import{B as m,u as T}from"./button-85bb5282.js";import{a as t,f as C}from"./check-0c8c6a9d.js";import{D as A,a as F,b as y,c as L,T as O}from"./TemplateNoData-f068f40d.js";import{S as c}from"./skeleton-855f6bb4.js";/* empty css            */import"./index-b260e8f0.js";/* empty css              */function q({plannedPayment:s,period:o}){let u=(Math.random()+1).toString(36).substring(7);const[p,h]=a.useState(!1);return e.jsx("section",{onClick:d=>{h(!0)},children:e.jsxs("div",{className:" flex flex-col gap-2 border rounded p-4 cursor-pointer",children:[e.jsxs("div",{className:" flex flex-row gap-6 justify-between",children:[e.jsx("span",{className:" whitespace-nowrap overflow-hidden overflow-ellipsis font-semibold",children:s&&s?`${s.parent?`${s.parent.name} - `:""}${s==null?void 0:s.name}`:"Wallet Name"}),e.jsx("div",{children:e.jsxs(A,{open:p,onOpenChange:h,children:[e.jsx(F,{asChild:!0,children:e.jsx(m,{variant:"link",className:" p-0 h-auto leading-none dark:!text-white !text-black","data-type":"dropdown-trigger",children:e.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})})}),e.jsx(y,{sideOffset:5,alignOffset:0,side:"left",align:"start",children:e.jsx(R,{href:s?route("sys.planned-payment.summary.show",{wallet:s.uuid,period:o!==void 0?t(o).format("YYYY-MM"):null}):"#",children:e.jsx(L,{className:" cursor-pointer",children:e.jsx("span",{className:" text-blue-500",children:"Detail"})})})})]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:" flex flex-col gap-1",children:[e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:(()=>{if(s&&"expected_planned_income"in s){let n=0,x="expected";typeof s.expected_planned_income=="object"?n=s.expected_planned_income.length:typeof s.expected_planned_income=="number"&&(n=s.expected_planned_income);var d=t(o).isBefore(t(),"month")||t(o).isSame(t(),"month")&&t(o).isBefore(t(),"year");return d&&(x="recorded"),`${n} ${x} Income`}return e.jsx(e.Fragment,{})})()}),e.jsx("span",{className:"text-green-500",children:C(s&&s.expected_income?s.expected_income:0)})]}),e.jsxs("div",{className:" flex flex-row justify-between",children:[e.jsx("span",{children:(()=>{if(s&&"expected_planned_expense"in s){let n=0,x="expected";typeof s.expected_planned_expense=="object"?n=s.expected_planned_expense.length:typeof s.expected_planned_expense=="number"&&(n=s.expected_planned_expense);var d=t(o).isBefore(t(),"month")||t(o).isSame(t(),"month")&&t(o).isBefore(t(),"year");return d&&(x="recorded"),`${n} ${x} Income`}return e.jsx(e.Fragment,{})})()}),e.jsx("span",{className:"text-red-500",children:C(s&&s.expected_expense?s.expected_expense:0)})]})]})]})},u)}function z(){let s=(Math.random()+1).toString(36).substring(7);return e.jsx("section",{children:e.jsxs("div",{className:" flex flex-col gap-2 border rounded p-4 cursor-pointer",children:[e.jsxs("div",{className:" flex flex-row gap-6 justify-between",children:[e.jsx(c,{className:"h-4 w-40"}),e.jsx(c,{className:"h-4 w-2"})]}),e.jsxs("div",{className:" mt-2 flex flex-col gap-2",children:[e.jsx(c,{className:"h-1 w-full"}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:" flex flex-row gap-2",children:[e.jsx(c,{className:" h-4 w-4"}),e.jsx(c,{className:" h-4 w-20"})]}),e.jsx(c,{className:" h-4 w-6"})]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:" flex flex-row gap-2",children:[e.jsx(c,{className:" h-4 w-4"}),e.jsx(c,{className:" h-4 w-20"})]}),e.jsx(c,{className:" h-4 w-6"})]})]})]})},s)}function Z({auth:s}){const o=T();a.useEffect(()=>{v()},[]);const[u,p]=a.useState(null),[h,d]=a.useState(!0),[n,x]=a.useState();let _=5;const[g,M]=a.useState(_),[k,b]=a.useState(!1),v=async()=>{d(!0),u instanceof AbortController&&u.abort();const r=new AbortController;p(r);const l=[],j={filter_period:t(f).format("YYYY-MM-DD"),filter_period_timezone:t.tz.guess(),limit:g};for(const i in j)l.push(encodeURIComponent(i)+"="+encodeURIComponent(j[i]));try{let Y=(await N.get(`${route("api.planned-payment.summary.v1.list")}?${l.join("&")}`,{cancelToken:new N.CancelToken(function(B){r.abort=B})})).data;x(Y.result.data),b(Y.result.has_more),d(!1),p(null)}catch(i){N.isCancel(i)?console.log("Request was canceled",i):console.error("Error:",i)}};let D=r=>(console.log(r),e.jsx(q,{plannedPayment:r,period:t(f).toDate()}));const[I,$]=a.useState(5);let E=()=>e.jsx(z,{});a.useEffect(()=>{n&&$(n.length>0?n.length:3)},[n]);const[f,S]=a.useState();if(f===void 0){let r=t();S(t(r).toDate())}const w=(r="prev")=>{let l=t(f);r==="prev"?l=t(l).subtract(1,"months"):r==="next"?l=t(l).add(1,"months"):r==="current"&&(l=t()),S(t(l).toDate())};return a.useEffect(()=>{o||v()},[g,f]),a.useEffect(()=>{if(!o){const r=()=>{console.log("ABC"),setTimeout(()=>{v()},100)};return document.addEventListener("planned-payment.refresh",r),()=>{document.removeEventListener("planned-payment.refresh",r)}}}),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" flex justify-between items-center",children:[e.jsx(m,{variant:"ghost",onClick:()=>{w("prev")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-left"})})}),e.jsx("div",{className:"flex flex-col",children:e.jsx(m,{variant:"outline",className:"px-6",children:t(f).format("MMMM, YYYY")})}),e.jsx(m,{variant:"ghost",onClick:()=>{w("next")},children:e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-angle-right"})})})]}),(()=>t().format("YYYY-MM-DD")!=t(f).format("YYYY-MM-DD")?e.jsxs(m,{variant:"link",className:"py-0",onClick:()=>{w("current")},children:["Back to current period (",t().format("MMM, YYYY"),")"]}):e.jsx(e.Fragment,{}))()]}),e.jsx("div",{className:" flex flex-col gap-4",children:(()=>{if(h){let r=[];for(let l=0;l<I;l++)r.push(e.jsx("div",{children:E()},`skeleton-${l}`));return r}else{let r=[],l=e.jsx(O,{});return n&&n.length>0&&n.map((j,i)=>{r.push(e.jsx("div",{children:D(j)},`planned_item-${i}`))}),r.length>0?r:l}})()}),e.jsx("div",{children:e.jsx(m,{variant:"outline",className:"dark:border-white",disabled:!k,onClick:()=>{b(!1),M(g+_)},children:"Load more"})})]})})}export{Z as default};
